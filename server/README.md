# æ˜“å®¿é…’åº—é¢„è®¢å¹³å° - åç«¯æœåŠ¡

åŸºäº Node.js + Express + Prisma çš„é…’åº—ç®¡ç†å¹³å°åç«¯æœåŠ¡ï¼Œæä¾›å•†æˆ·ç«¯é…’åº—ç®¡ç†å’Œç®¡ç†å‘˜ç«¯å®¡æ ¸å‘å¸ƒåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” ç”¨æˆ·è®¤è¯ä¸æˆæƒï¼ˆJWTï¼‰
- ğŸ¨ é…’åº—ä¿¡æ¯ç®¡ç†ï¼ˆå•†æˆ·ç«¯ï¼‰
- âœ… é…’åº—å®¡æ ¸å‘å¸ƒï¼ˆç®¡ç†å‘˜ç«¯ï¼‰
- ğŸ“· å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- ğŸ“ å®Œæ•´çš„æ•°æ®æ ¡éªŒ

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.x
- MySQL >= 5.7

### å®‰è£…ä¾èµ–

```bash
npm install
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
DATABASE_URL="mysql://root@localhost:3306/yisu-hotel-db"
JWT_SECRET="your-secret-key-here"
PORT=3000
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run prisma:generate
npm run prisma:migrate
```

### å¯åŠ¨æœåŠ¡

```bash
npm start
```

æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

## API åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:3000/api/v1`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)
- **æ•°æ®æ ¼å¼**: JSON

## æ¥å£åˆ—è¡¨

### è®¤è¯æ¨¡å—

| æ¥å£     | æ–¹æ³• | è·¯å¾„           | è¯´æ˜     | æƒé™ |
| -------- | ---- | -------------- | -------- | ---- |
| ç”¨æˆ·æ³¨å†Œ | POST | /auth/register | ç”¨æˆ·æ³¨å†Œ | å…¬å¼€ |
| ç”¨æˆ·ç™»å½• | POST | /auth/login    | ç”¨æˆ·ç™»å½• | å…¬å¼€ |

### é…’åº—ç®¡ç†æ¨¡å—ï¼ˆå•†æˆ·ç«¯ï¼‰

| æ¥å£            | æ–¹æ³• | è·¯å¾„              | è¯´æ˜               | æƒé™     |
| --------------- | ---- | ----------------- | ------------------ | -------- |
| è·å–/åˆå§‹åŒ–é…’åº— | GET  | /hotels/my        | è·å–å•†æˆ·çš„é…’åº—ä¿¡æ¯ | merchant |
| æ›´æ–°é…’åº—ä¿¡æ¯    | PUT  | /hotels/my        | æ›´æ–°é…’åº—ä¿¡æ¯       | merchant |
| æäº¤å®¡æ ¸        | PUT  | /hotels/my/submit | æäº¤é…’åº—å®¡æ ¸       | merchant |
| å–æ¶ˆæäº¤        | PUT  | /hotels/my/cancel | å–æ¶ˆæäº¤å®¡æ ¸       | merchant |

### é…’åº—å®¡æ ¸æ¨¡å—ï¼ˆç®¡ç†å‘˜ç«¯ï¼‰

| æ¥å£         | æ–¹æ³• | è·¯å¾„                      | è¯´æ˜             | æƒé™  |
| ------------ | ---- | ------------------------- | ---------------- | ----- |
| è·å–é…’åº—åˆ—è¡¨ | GET  | /admin/hotels             | è·å–æ‰€æœ‰é…’åº—åˆ—è¡¨ | admin |
| è·å–é…’åº—è¯¦æƒ… | GET  | /admin/hotels/:id         | è·å–é…’åº—è¯¦ç»†ä¿¡æ¯ | admin |
| å®¡æ ¸é€šè¿‡     | PUT  | /admin/hotels/:id/approve | å®¡æ ¸é€šè¿‡         | admin |
| å®¡æ ¸ä¸é€šè¿‡   | PUT  | /admin/hotels/:id/reject  | å®¡æ ¸ä¸é€šè¿‡       | admin |
| å‘å¸ƒé…’åº—     | PUT  | /admin/hotels/:id/publish | å‘å¸ƒé…’åº—ä¸Šçº¿     | admin |
| ä¸‹çº¿é…’åº—     | PUT  | /admin/hotels/:id/offline | ä¸‹çº¿é…’åº—         | admin |
| æ¢å¤ä¸Šçº¿     | PUT  | /admin/hotels/:id/restore | æ¢å¤å·²ä¸‹çº¿é…’åº—   | admin |

### æ–‡ä»¶ä¸Šä¼ æ¨¡å—

| æ¥å£     | æ–¹æ³• | è·¯å¾„           | è¯´æ˜         | æƒé™           |
| -------- | ---- | -------------- | ------------ | -------------- |
| å•å›¾ä¸Šä¼  | POST | /upload/image  | ä¸Šä¼ å•å¼ å›¾ç‰‡ | merchant/admin |
| å¤šå›¾ä¸Šä¼  | POST | /upload/images | ä¸Šä¼ å¤šå¼ å›¾ç‰‡ | merchant/admin |

## é…’åº—çŠ¶æ€æµè½¬

```
draft â”€â”€æäº¤å®¡æ ¸â”€â”€> pending â”€â”€å®¡æ ¸é€šè¿‡â”€â”€> approved â”€â”€å‘å¸ƒâ”€â”€> published
  â†‘                    â”‚                                 â”‚
  â”‚                    â””â”€â”€å®¡æ ¸ä¸é€šè¿‡â”€â”€> rejected          â”‚
  â”‚                                         â”‚            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç¼–è¾‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                                          â”‚
                        offline <â”€â”€â”€â”€â”€â”€ä¸‹çº¿â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€æ¢å¤â”€â”€> published
```

## ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€çš„ä¿¡å°æ ¼å¼ï¼š

```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

## å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡å™¨
npm start

# ç”Ÿæˆ Prisma Client
npm run prisma:generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npm run prisma:migrate

# æ‰“å¼€ Prisma Studio(åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•°æ®åº“)
npm run prisma:studio

# æ ¹æ® schema.prisma ç›´æ¥åŒæ­¥æ•°æ®åº“ç»“æ„
npx prisma db push
```

## æŠ€æœ¯æ ˆ

- **Node.js** - è¿è¡Œæ—¶ç¯å¢ƒ
- **Express** - Web æ¡†æ¶
- **Prisma** - ORM æ¡†æ¶
- **MySQL** - æ•°æ®åº“
- **JWT** - èº«ä»½è®¤è¯
- **bcryptjs** - å¯†ç åŠ å¯†
- **multer** - æ–‡ä»¶ä¸Šä¼ 

## é¡¹ç›®ç»“æ„

```
server/
â”œâ”€â”€ app.js                 # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â”œâ”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡
â”œâ”€â”€ uploads/              # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ prisma/               # Prisma é…ç½®
â”‚   â””â”€â”€ schema.prisma     # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ controllers/          # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ userController.js
â”‚   â”œâ”€â”€ hotelController.js
â”‚   â”œâ”€â”€ adminController.js
â”‚   â””â”€â”€ uploadController.js
â”œâ”€â”€ middleware/           # ä¸­é—´ä»¶
â”‚   â””â”€â”€ auth.js
â”œâ”€â”€ routes/               # è·¯ç”±å±‚
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ hotel.js
â”‚   â”œâ”€â”€ admin.js
â”‚   â””â”€â”€ upload.js
â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ jwt.js
â”‚   â”œâ”€â”€ response.js
â”‚   â””â”€â”€ upload.js
â”œâ”€â”€ constants/            # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ response.js
â””â”€â”€ docs/                 # æ–‡æ¡£
    â”œâ”€â”€ API_DESIGN.md
    â””â”€â”€ DATABASE_DESIGN.md
```

## æ–‡æ¡£

- [API è®¾è®¡æ–‡æ¡£](./docs/API_DESIGN.md) - å®Œæ•´çš„æ¥å£è®¾è®¡æ–‡æ¡£
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./docs/DATABASE_DESIGN.md) - æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

## å®‰å…¨ç‰¹æ€§

- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- JWT ä»¤ç‰Œè®¤è¯ï¼Œæœ‰æ•ˆæœŸ 24 å°æ—¶
- ç»Ÿä¸€çš„æ•°æ®æ ¡éªŒå’Œé”™è¯¯å¤„ç†
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆPrisma ORMï¼‰
- æ–‡ä»¶ä¸Šä¼ ç±»å‹å’Œå¤§å°é™åˆ¶

## è®¸å¯è¯

MIT
